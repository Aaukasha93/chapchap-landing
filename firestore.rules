rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Waitlist collection - allow anyone to add their email, but not read others
    match /waitlist/{document} {
      // Allow anyone to create a new waitlist entry
      allow create: if request.resource.data.keys().hasAll(['email', 'subscribedAt', 'source', 'status'])
                    && request.resource.data.email is string
                    && request.resource.data.email.matches('^[^@]+@[^@]+\\.[^@]+$')
                    && request.resource.data.subscribedAt is string
                    && request.resource.data.source is string
                    && request.resource.data.status == 'pending';
      
      // Allow reading to check for duplicates (limited to email field only)
      allow read: if request.auth != null || true; // Allow public read for duplicate checking
      
      // Only admins can update or delete
      allow update, delete: if false; // Disable for now, enable when you add admin authentication
    }
    
    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
